---
import BaseLayout from "@layouts/base-layout.astro";
import TagGroup from "@components/tag-group.tsx";
import { getCollection } from "astro:content";
import {
  getUniqueLowerCaseTagMap,
  getSortedPostSearchItemsWithLang,
} from "@scripts/utils";
import { ui } from "@i18n/ui";
import type { PostSearchItem } from "@schemas/index";

const { lang } = Astro.props;
const allPosts = await getCollection("posts");
const tags = getUniqueLowerCaseTagMap(
  (await getSortedPostSearchItemsWithLang(allPosts, lang))
    .map((post: PostSearchItem) => post.tags)
    .flat(),
);

export function getStaticPaths() {
  return Object.keys(ui).map((lang) => ({
    params: { lang: lang as keyof typeof ui },
    props: { lang: lang as keyof typeof ui },
  }));
}
---

<BaseLayout>
  <TagGroup lang={lang} tagMap={tags} client:load />
</BaseLayout>
