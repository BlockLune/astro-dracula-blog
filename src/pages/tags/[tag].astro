---
import { getCollection } from "astro:content";
import { getUniqueLowerCaseTagMap, makeUniqueByLang } from "@/utils/post";
import { defaultLang, useTranslatedPath } from "@/utils/i18n";

export const getStaticPaths = async () => {
  const posts = await getCollection("posts");
  const uniquePosts = makeUniqueByLang(posts, defaultLang);
  const tags = getUniqueLowerCaseTagMap(
    uniquePosts.map((uniquePost) => uniquePost.data.tags).flat()
  );
  return Array.from(tags.keys()).map((tag) => ({ params: { tag } }));
};

const { tag } = Astro.params;
const translatedPath = useTranslatedPath(defaultLang);
return Astro.rewrite(translatedPath(`/tags/${tag}`));
---
