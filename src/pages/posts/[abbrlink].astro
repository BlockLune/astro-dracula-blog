---
import MarkdownPost from "../../components/markdown-post.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const { abbrlink } = Astro.params;
const postsWithAbbrlink = await getCollection(
  "posts",
  (post) => post.data.abbrlink
);
const post = postsWithAbbrlink.find((post) => post.data.abbrlink === abbrlink);

if (!post) {
  Astro.redirect("/404");
}

export async function getStaticPaths() {
  const postsWithAbbrlink = await getCollection(
    "posts",
    (post) => post.data.abbrlink
  );
  return postsWithAbbrlink.map((post) => ({
    params: { abbrlink: post.data.abbrlink },
    props: { post },
  }));
}
---

<BaseLayout>
  <MarkdownPost post={post} />
</BaseLayout>
